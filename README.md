# 闲鱼代写助手

帮助闲鱼平台代写服务卖家专业回复买家咨询，智能挖掘需求，提升成交率。

## 功能特性

### 核心功能
- **多轮对话**：引入"会话"概念，一个买家=一个会话，保持上下文连续性
- **智能回复**：返回3-5个可选回复，每个有独立复制按钮
- **会话管理**：会话状态管理（进行中/已结束），区分活跃和历史对话
- **智能报价**：信息足够时提示"可以报价"，支持难度系数调整
- **报价表查看**：新增报价页面，可查看完整服务价格表
- **需求要点提炼**：成交时自动提炼用户需求要点，方便执行订单
- **挽留话术**：未成交时提供可配置的挽留话术模板
- **文件上传**：支持上传文档/图片，AI 结合资料分析

### 移动端适配
- **响应式布局**：桌面端侧边栏，移动端底部导航栏
- **对话面板适配**：移动端上下布局，推荐回复弹窗显示
- **触摸优化**：按钮尺寸、间距适配触摸操作
- **安全区域**：支持 iPhone 底部安全区域
- **复制功能修复**：兼容 HTTP 环境的剪贴板操作

### V4.1 新特性
- **报价页面**：新增「报价」菜单，可查看完整报价表
- **报价参考优化**：对话中显示当前文章类型的单价范围
- **报价计算器**：成交时支持难度系数调整，自动计算价格范围
- **条件显示优化**：「仍需了解」仅在对话进行中显示
- **代码精简**：移除 V2 快速分析功能，精简代码结构

## 技术栈

- **前端**：React 18 + TypeScript + Vite + Tailwind CSS
- **后端**：Python 3.11 + FastAPI + SQLite
- **AI**：支持自定义大模型API（OpenAI / DeepSeek / Claude / 其他兼容API）

## 快速开始

### 环境要求

- Node.js 22+
- Python 3.11+（推荐使用 conda）

### 安装依赖

```bash
# 前端
cd frontend
npm install

# 后端
cd backend
pip install -r requirements.txt
```

### 启动开发服务器

```bash
# 启动前端（端口 5173）
cd frontend
npm run dev

# 启动后端（端口 8000）
cd backend
python run.py
```

### 访问应用

打开浏览器访问 http://localhost:5173

## 使用说明

### 对话助手模式

1. 点击「设置」配置大模型 API
2. 在对话区域粘贴买家消息
3. 点击「发送」获取 AI 推荐回复（3-5个选项）
4. 点击推荐回复选择并复制，粘贴到闲鱼
5. 继续粘贴买家的回复，进行多轮对话
6. 对话结束后点击「结束会话」标记成交状态

### 报价功能

- 点击「报价」菜单查看完整服务价格表
- 对话时右侧显示当前文章类型的单价范围
- 成交时可调整难度系数计算最终报价

### 会话历史

- 「历史」展示所有会话记录
- 支持按状态、类型筛选
- 点击会话可查看完整对话内容

## 项目结构

```
xianyu_answer/
├── frontend/              # React 前端
│   ├── src/
│   │   ├── components/    # UI 组件
│   │   ├── hooks/         # 自定义 Hooks
│   │   ├── services/      # API 调用
│   │   └── types/         # TypeScript 类型
│   └── package.json
│
├── backend/               # FastAPI 后端
│   ├── app/
│   │   ├── main.py        # 入口文件
│   │   ├── routers/       # API 路由
│   │   ├── services/      # 业务服务
│   │   ├── models/        # 数据模型
│   │   ├── database/      # SQLite 数据库
│   │   └── prompts/       # 提示词模板
│   ├── data/
│   │   └── xianyu.db      # SQLite 数据库文件
│   └── requirements.txt
│
├── 报价参考.xlsx           # 服务类型与价格数据
├── deploy.sh              # 一键部署脚本
├── CLAUDE.md              # 开发指南
├── Prd.md                 # 产品需求文档
└── README.md              # 本文件
```

## API 端点

### 对话会话

| 方法 | 端点 | 功能 |
|------|------|------|
| POST | /api/sessions | 创建新会话 |
| GET | /api/sessions | 获取会话列表 |
| GET | /api/sessions/{id} | 获取会话详情 |
| PATCH | /api/sessions/{id} | 更新会话状态 |
| DELETE | /api/sessions/{id} | 删除会话 |
| POST | /api/sessions/{id}/analyze | 发送消息并分析 |
| POST | /api/sessions/{id}/summarize | 提炼需求要点 |

### 其他

| 方法 | 端点 | 功能 |
|------|------|------|
| POST | /api/test-connection | 测试 LLM 连接 |
| GET | /api/services | 获取服务类型列表 |
| GET/PUT | /api/prompts | 获取/更新提示词 |
| GET/PUT | /api/retention-template | 挽留话术模板 |
| GET/PUT | /api/review-template | 要好评话术模板 |

## 提示词配置

在「提示词」设置中可编辑 3 个模板：

- **对话分析**：多轮对话分析的提示词
- **挽留话术**：未成交时的挽留模板
- **要好评话术**：成交后索要好评的模板

## 部署

### 服务器信息

| 项目 | 值 |
|------|-----|
| 服务器 | 腾讯云轻量应用服务器 |
| IP | 111.231.107.149 |
| 系统 | OpenCloudOS 9 + 宝塔面板 |
| 本项目域名 | xianyu.wyqaii.top |

### 访问地址

- **备案前**：`http://111.231.107.149:8080`
- **备案后**：`https://xianyu.wyqaii.top`

### 一键部署

```bash
# 本地执行部署脚本
./deploy.sh

# 完成后在宝塔面板「进程守护管理器」重启 xianyu_answer
```

### 重启失败处理

如果重启后进程立即停止或端口被占用：
```bash
# 清理端口 8000 上的残留进程
lsof -ti:8000 | xargs kill -9

# 然后在宝塔面板重新启动
```

### 配置 SSH 免密登录（可选）

```bash
# 上传公钥到服务器（需输入一次密码）
ssh-copy-id -i ~/.ssh/id_ed25519.pub root@111.231.107.149
# 配置后运行 deploy.sh 无需输入密码
```

### 详细文档

完整部署指南请参考 [Prd.md 第八章](./Prd.md#八部署方案)

## 版本历史

| 版本 | 主要功能 |
|------|----------|
| V1.0 | 智能分析、专业回复、智能报价、服务速查 |
| V2.0 | 历史记录、成交标记、回复模板库 |
| V3.0 | 对话式助手、多轮对话、会话管理、需求提炼 |
| V4.0 | 移动端适配、响应式布局、底部导航 |
| V4.1 | 报价页面、报价计算器、文件上传、代码精简 |

## License

MIT
